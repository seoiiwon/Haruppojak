<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Write Diary</title>
    <link rel="stylesheet" href="../../static/css/DiaryPage/writeDiary.css" />
    <link rel="stylesheet" href="../../static/css/tabbar.css" />
    <script>
      let selectedTodos = [];

      // 현재 날짜를 가져와서 표시
      window.onload = function () {
        var today = new Date();
        var date =
          today.getFullYear() +
          '년 ' +
          (today.getMonth() + 1) +
          '월 ' +
          today.getDate() +
          '일';
        document.getElementById('current-date').innerText = date;
      };

      // 모달을 여는 함수
      function openModal() {
        document.getElementById('modal').style.display = 'block';
      }

      // 모달을 닫는 함수
      function closeModal() {
        document.getElementById('modal').style.display = 'none';
      }

      // '오늘의 To Do 불러오기' 클릭 시 모달을 열기
      function showTodoModal() {
        openModal();
        displayTodos();
      }

      // '뽀짝이가 답장을 써줄 거예요!' 클릭 시 'reply.html'로 이동
      function goToReply() {
        window.location.href = 'reply.html';
      }

      // 투두리스트 데이터를 로드하고 모달에 표시하는 함수
      function displayTodos() {
        const todos = [
          { text: '투두리스트 항목 1', completed: false },
          { text: '투두리스트 항목 2', completed: true },
          { text: '투두리스트 항목 3', completed: false },
        ];

        const todoList = document.getElementById('todo-list');
        todoList.innerHTML = '';

        todos.forEach((todo, index) => {
          const todoItem = document.createElement('li');
          todoItem.classList.add('todo-item');

          const checkImg = document.createElement('img');
          checkImg.src = todo.completed
            ? '../../static/img/DiaryPage/checked-fill.svg'
            : '../../static/img/DiaryPage/checked.svg';
          checkImg.classList.add('check-img');

          const pawprintImg = document.createElement('img');
          pawprintImg.src = selectedTodos.includes(todo.text)
            ? '../../static/img/DiaryPage/pawprint-fill.svg'
            : '../../static/img/DiaryPage/pawprint.svg';
          pawprintImg.classList.add('pawprint-img');
          pawprintImg.onclick = () => toggleTodoInDiary(index, todo.text);

          const todoText = document.createElement('span');
          todoText.textContent = todo.text;
          todoText.onclick = () => toggleTodoInDiary(index, todo.text);

          todoItem.appendChild(checkImg);
          todoItem.appendChild(todoText);
          todoItem.appendChild(pawprintImg);

          todoList.appendChild(todoItem);
        });
      }

      // 투두리스트 항목을 일기에 추가하거나 제거하는 함수
      function toggleTodoInDiary(index, todoText) {
        const diary = document.querySelector('.diary-textfield');
        const todoItems = document.querySelectorAll('.todo-item');
        const pawprintImg = todoItems[index].querySelector('.pawprint-img');

        if (!selectedTodos.includes(todoText)) {
          selectedTodos.push(todoText);
          pawprintImg.src = '../../static/img/DiaryPage/pawprint-fill.svg';
        } else {
          selectedTodos = selectedTodos.filter((todo) => todo !== todoText);
          pawprintImg.src = '../../static/img/DiaryPage/pawprint.svg';
        }

        updateDiaryText(diary);
      }

      function updateDiaryText(diary) {
        const todoText = selectedTodos.join('\n');
        const diaryContent = diary.value.split('\n\n');
        diary.value = `${todoText}\n\n${diaryContent.slice(1).join('\n\n')}`;
      }
    </script>
  </head>
  <body>
    <div class="container">
      <div class="content">
        <div class="header">
          <img
            src="../../static/img/DiaryPage/sun.max.png"
            alt="Weather Image"
            class="weather-image"
          />
          <ul class="date-wrapper">
            <li id="current-date" class="date"></li>
            <li class="header-text">오늘은 화창한 뽀짝데이였어요!</li>
          </ul>
        </div>
        <div onclick="showTodoModal()" class="todo-button">
          <img src="../../static/img/DiaryPage/pen.svg" alt="pen" /> 오늘의 To
          Do 불러오기
        </div>
        <div class="modal" id="modal">
          <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <p>불러올 투두를 선택하세요!</p>
            <ul id="todo-list"></ul>
          </div>
        </div>
        <textarea
          class="diary-textfield"
          placeholder="오늘의 뽀짝을 기록해 보아요"
        ></textarea>
        <div id="todo-diary-separator"></div>
        <!-- 투두리스트와 일기 사이의 구분선 -->
        <div class="footer">
          <a href="#" onclick="goToReply()"
            >오늘의 뽀짝을 기록하셨나요?<br />뽀짝이가 답장을 써줄 거예요!</a
          >
        </div>
        <!-- 탭바 시작 -->
        <div class="tabbar">
          <div class="tab">
            <img src="../../static/img/tabbar/홈-off.png" alt="Home" />
          </div>
          <div class="tab">
            <img src="../../static/img/tabbar/캘린더-off.png" alt="Calendar" />
          </div>
          <div class="tab">
            <img src="../../static/img/tabbar/일기-off.png" alt="Diary" />
          </div>
          <div class="tab">
            <img
              src="../../static/img/tabbar/마이페이지-off.png"
              alt="MyPage"
            />
          </div>
        </div>
        <!-- 탭바 끝 -->
      </div>
    </div>
  </body>
</html>
